-- CREATE TABLE
CREATE TABLE CADEMPRE
(
  NCODIEMPRE NUMBER NOT NULL,
  CNOMEEMPRE VARCHAR2(100) NOT NULL,
  CFANTEMPRE VARCHAR2(100) NOT NULL,
  CCNPJEMPRE VARCHAR2(18) NOT NULL,
  CNAFUEMPRE VARCHAR2(100) NOT NULL,
  BLAFUEMPRE BLOB
);
-- ADD COMMENTS TO THE TABLE 
COMMENT ON TABLE CADEMPRE
  IS 'Tabela de empresa';
-- ADD COMMENTS TO THE COLUMNS 
COMMENT ON COLUMN CADEMPRE.NCODIEMPRE
  IS 'código da empresa';
COMMENT ON COLUMN CADEMPRE.CNOMEEMPRE
  IS 'nome da empresa';
COMMENT ON COLUMN CADEMPRE.CFANTEMPRE
  IS 'nome fantasia da empresa';
COMMENT ON COLUMN CADEMPRE.CCNPJEMPRE
  IS 'cnpj da empresa';
COMMENT ON COLUMN CADEMPRE.CNAFUEMPRE
  IS 'nome da associação dos funcionários';
COMMENT ON COLUMN CADEMPRE.BLAFUEMPRE
  IS 'logo da associaçao dos funcionários';  
-- CREATE/RECREATE PRIMARY, UNIQUE AND FOREIGN KEY CONSTRAINTS 
ALTER TABLE CADEMPRE
  ADD CONSTRAINT PK_CADEMPRE PRIMARY KEY (NCODIEMPRE)
  USING INDEX;
  
CREATE SEQUENCE CAD_SCADEMPRE NOCACHE START WITH 5;  
  
INSERT INTO CADEMPRE
  (NCODIEMPRE, CNOMEEMPRE, CFANTEMPRE, CCNPJEMPRE, CNAFUEMPRE)
VALUES
  (1,
   'COOPERATIVA AGROINDUSTRIAL NOVA PRODUTIVA',
   'NOVA PRODUTIVA',
   '03.341.641/0001-76',
   'ASSOCIACAO DOS FUNCIONARIOS DA NOVA PRODUTIVA');

INSERT INTO CADEMPRE
  (NCODIEMPRE, CNOMEEMPRE, CFANTEMPRE, CCNPJEMPRE, CNAFUEMPRE)
VALUES
  (2,
   'COOPERATIVA AGRICOLA ASTORGA',
   'COCAFE',
   '00.000.000/0000-01',
   'ASSOCIACAO DOS FUNCIONARIOS DA NOVA PRODUTIVA');

INSERT INTO CADEMPRE
  (NCODIEMPRE, CNOMEEMPRE, CFANTEMPRE, CCNPJEMPRE, CNAFUEMPRE)
VALUES
  (3,
   'AUTO POSTO PETROANGULO LTDA',
   'NOVA AUTO POSTO II',
   '00.000.000/0000-03',
   'ASSOCIACAO DOS FUNCIONARIOS DA NOVA PRODUTIVA');

INSERT INTO CADEMPRE
  (NCODIEMPRE, CNOMEEMPRE, CFANTEMPRE, CCNPJEMPRE, CNAFUEMPRE)
VALUES
  (4,
   'AUTO POSTO REUNIDOS LTDA',
   'NOVA AUTO POSTO I',
   '30.365.872/0001-14',
   'ASSOCIACAO DOS FUNCIONARIOS DA NOVA PRODUTIVA');  
   
INSERT INTO CADEMPRE
  (NCODIEMPRE, CNOMEEMPRE, CFANTEMPRE, CCNPJEMPRE, CNAFUEMPRE)
VALUES
  (99,
   'LANCHONETE',
   'LANCHONETE',
   '00.000.000/0000-00',
   'ASSOCIACAO DOS FUNCIONARIOS DA NOVA PRODUTIVA');    
---------------
-- CREATE TABLE
CREATE TABLE CADFILIA
(
  NCODIFILIA NUMBER NOT NULL,
  NCODIEMPRE NUMBER NOT NULL,
  CCODIFILIA VARCHAR2(3) NOT NULL,
  CNOMEFILIA VARCHAR2(255) NOT NULL,
  CCIDAFILIA VARCHAR2(255) NOT NULL
);
-- ADD COMMENTS TO THE TABLE 
COMMENT ON TABLE CADFILIA
  IS 'Tabela de Filial';
-- ADD COMMENTS TO THE COLUMNS 
COMMENT ON COLUMN CADFILIA.NCODIFILIA
  IS 'código da Filial';
COMMENT ON COLUMN CADFILIA.NCODIEMPRE
  IS 'código da empresa';
COMMENT ON COLUMN CADFILIA.CCODIFILIA
  IS 'código da Filial do RM';
COMMENT ON COLUMN CADFILIA.CNOMEFILIA
  IS 'nome da Filial';
COMMENT ON COLUMN CADFILIA.CCIDAFILIA
  IS 'nome da cidade da Filial';    
-- CREATE/RECREATE INDEXES 
CREATE INDEX FK_CADFILIA_CADEMPRE ON CADFILIA (NCODIEMPRE);
-- CREATE/RECREATE PRIMARY, UNIQUE AND FOREIGN KEY CONSTRAINTS 
ALTER TABLE CADFILIA
  ADD CONSTRAINT PK_CADFILIA PRIMARY KEY (NCODIFILIA)
  USING INDEX;
ALTER TABLE CADFILIA
  ADD CONSTRAINT UK_CADFILIA UNIQUE (NCODIEMPRE, CNOMEFILIA)
  USING INDEX;
ALTER TABLE CADFILIA
  ADD CONSTRAINT FK_CADFILIA_CADEMPRE FOREIGN KEY (NCODIEMPRE)
  REFERENCES CADEMPRE (NCODIEMPRE);
  
CREATE SEQUENCE CAD_SCADFILIA NOCACHE START WITH 17;  
  
INSERT INTO CADFILIA
  (NCODIFILIA, NCODIEMPRE, CCODIFILIA, CNOMEFILIA, CCIDAFILIA)
VALUES
  (1, 1, '01', 'SEDE', 'ASTORGA');

INSERT INTO CADFILIA
  (NCODIFILIA, NCODIEMPRE, CCODIFILIA, CNOMEFILIA, CCIDAFILIA)
VALUES
  (2, 1, '02', 'NOVA AUTO POSTO', 'ASTORGA');

INSERT INTO CADFILIA
  (NCODIFILIA, NCODIEMPRE, CCODIFILIA, CNOMEFILIA, CCIDAFILIA)
VALUES
  (3, 1, '03', 'AGRICOLA CANA', 'ASTORGA');

INSERT INTO CADFILIA
  (NCODIFILIA, NCODIEMPRE, CCODIFILIA, CNOMEFILIA, CCIDAFILIA)
VALUES
  (4, 1, '04', 'ANGULO', 'ANGULO');

INSERT INTO CADFILIA
  (NCODIFILIA, NCODIEMPRE, CCODIFILIA, CNOMEFILIA, CCIDAFILIA)
VALUES
  (5, 1, '05', 'ADMINISTRATIVO', 'ASTORGA');

INSERT INTO CADFILIA
  (NCODIFILIA, NCODIEMPRE, CCODIFILIA, CNOMEFILIA, CCIDAFILIA)
VALUES
  (6, 1, '06', 'SANTA FÉ', 'SANTA FÉ');

INSERT INTO CADFILIA
  (NCODIFILIA, NCODIEMPRE, CCODIFILIA, CNOMEFILIA, CCIDAFILIA)
VALUES
  (7, 1, '07', 'COLORADO', 'COLORADO');

INSERT INTO CADFILIA
  (NCODIFILIA, NCODIEMPRE, CCODIFILIA, CNOMEFILIA, CCIDAFILIA)
VALUES
  (8, 1, '08', 'IGUARAÇU', 'IGUARAÇU');

INSERT INTO CADFILIA
  (NCODIFILIA, NCODIEMPRE, CCODIFILIA, CNOMEFILIA, CCIDAFILIA)
VALUES
  (9, 1, '09', 'ASTORGA', 'ASTORGA');

INSERT INTO CADFILIA
  (NCODIFILIA, NCODIEMPRE, CCODIFILIA, CNOMEFILIA, CCIDAFILIA)
VALUES
  (10, 1, '10', 'LOBATO', 'LOBATO');

INSERT INTO CADFILIA
  (NCODIFILIA, NCODIEMPRE, CCODIFILIA, CNOMEFILIA, CCIDAFILIA)
VALUES
  (11, 1, '11', 'SABÁUDIA', 'SABÁUDIA');

INSERT INTO CADFILIA
  (NCODIFILIA, NCODIEMPRE, CCODIFILIA, CNOMEFILIA, CCIDAFILIA)
VALUES
  (12, 1, '12', 'PITANGUEIRAS', 'PITANGUEIRAS');

INSERT INTO CADFILIA
  (NCODIFILIA, NCODIEMPRE, CCODIFILIA, CNOMEFILIA, CCIDAFILIA)
VALUES
  (13, 2, '01', 'SEDE', 'ASTORGA');

INSERT INTO CADFILIA
  (NCODIFILIA, NCODIEMPRE, CCODIFILIA, CNOMEFILIA, CCIDAFILIA)
VALUES
  (14, 2, '02', 'DESTILARIA', 'ASTORGA');

INSERT INTO CADFILIA
  (NCODIFILIA, NCODIEMPRE, CCODIFILIA, CNOMEFILIA, CCIDAFILIA)
VALUES
  (15, 3, '01', 'ANGULO', 'ANGULO');

INSERT INTO CADFILIA
  (NCODIFILIA, NCODIEMPRE, CCODIFILIA, CNOMEFILIA, CCIDAFILIA)
VALUES
  (16, 4, '02', 'ASTORGA', 'ASTORGA');

INSERT INTO CADFILIA
  (NCODIFILIA, NCODIEMPRE, CCODIFILIA, CNOMEFILIA, CCIDAFILIA)
VALUES
  (99, 99, '99', 'LANCHONETE', 'ASTORGA');  
  
---------------
-- CREATE TABLE
CREATE TABLE CADPERIO
(
  NCODIPERIO NUMBER NOT NULL,
  CDESCPERIO VARCHAR2(255) NOT NULL,
  NMES_PERIO NUMBER NOT NULL,
  NANO_PERIO NUMBER NOT NULL,
  DDINIPERIO DATE NOT NULL,
  DDFIMPERIO DATE NOT NULL,
  CSITUPERIO VARCHAR2(15) DEFAULT 'ABERTO' NOT NULL
);
-- ADD COMMENTS TO THE TABLE 
COMMENT ON TABLE CADPERIO
  IS 'Tabela de Período para Faturamento/Folha';
-- ADD COMMENTS TO THE COLUMNS 
COMMENT ON COLUMN CADPERIO.NCODIPERIO
  IS 'código do período';
COMMENT ON COLUMN CADPERIO.CDESCPERIO
  IS 'descrição do período';
COMMENT ON COLUMN CADPERIO.NMES_PERIO
  IS 'mês do período';
COMMENT ON COLUMN CADPERIO.NANO_PERIO
  IS 'ano do período';
COMMENT ON COLUMN CADPERIO.DDINIPERIO
  IS 'data de inicio do período';
COMMENT ON COLUMN CADPERIO.DDFIMPERIO
  IS 'data fim do período';
COMMENT ON COLUMN CADPERIO.CSITUPERIO
  IS 'situação do período';
-- CREATE/RECREATE PRIMARY, UNIQUE AND FOREIGN KEY CONSTRAINTS 
ALTER TABLE CADPERIO
  ADD CONSTRAINT PK_CADPERIO PRIMARY KEY (NCODIPERIO)
  USING INDEX;
ALTER TABLE CADPERIO
  ADD CONSTRAINT UK_CADPERIO UNIQUE (NMES_PERIO, NANO_PERIO)
  USING INDEX;
  
CREATE SEQUENCE CAD_SCADPERIO NOCACHE;

DECLARE

  DIA_INICIAL DATE := '16/' || TO_CHAR(SYSDATE, 'MM/YYYY');
  DIA_FINAL   DATE := '15/' || TO_CHAR(SYSDATE, 'MM/YYYY');

  MES NUMBER := TO_CHAR(SYSDATE, 'MM');
  ANO NUMBER := TO_CHAR(SYSDATE, 'YYYY');

  REFERENTE VARCHAR2(4000) := 'REFERENTE ';

BEGIN

  FOR L IN 1 .. 24 LOOP
  
    REFERENTE := 'REFERENTE ' || UPPER(TO_CHAR(DIA_FINAL, 'fmMonth/YYYY', 'NLS_DATE_LANGUAGE=PORTUGUESE'));
  
    INSERT INTO CADPERIO
      (NCODIPERIO,
       CDESCPERIO,
       NMES_PERIO,
       NANO_PERIO,
       DDINIPERIO,
       DDFIMPERIO,
       CSITUPERIO)
    VALUES
      (CAD_SCADPERIO.NEXTVAL,
       REFERENTE,
       TO_CHAR(DIA_FINAL, 'MM'),
       TO_CHAR(DIA_FINAL, 'YYYY'),
       ADD_MONTHS(DIA_INICIAL, -1),
       DIA_FINAL,
       'FECHADO');
  
    DIA_INICIAL := ADD_MONTHS(DIA_INICIAL, 1);
    DIA_FINAL   := ADD_MONTHS(DIA_FINAL, 1);
  
  END LOOP;

END;
/ 
---------------
-- CREATE TABLE
CREATE TABLE CADEVENT
(
  NCODIEVENT NUMBER NOT NULL,
  NCODIEMPRE NUMBER NOT NULL,
  CCODIEVENT VARCHAR2(4) NOT NULL,
  CDESCEVENT VARCHAR2(255) NOT NULL
);
-- ADD COMMENTS TO THE TABLE 
COMMENT ON TABLE CADEVENT
  IS 'Tabela de Eventos para Desconto em Folha';
-- ADD COMMENTS TO THE COLUMNS 
COMMENT ON COLUMN CADEVENT.NCODIEVENT
  IS 'código do evento';
COMMENT ON COLUMN CADEVENT.NCODIEMPRE
  IS 'código da empresa';
COMMENT ON COLUMN CADEVENT.CCODIEVENT
  IS 'código do evento para folha de pagamento';
COMMENT ON COLUMN CADEVENT.CDESCEVENT
  IS 'descrição do evento';
-- CREATE/RECREATE INDEXES 
CREATE INDEX FK_CADEVENT_CADEMPRE ON CADEVENT (NCODIEMPRE);
-- CREATE/RECREATE PRIMARY, UNIQUE AND FOREIGN KEY CONSTRAINTS 
ALTER TABLE CADEVENT
  ADD CONSTRAINT PK_CADEVENT PRIMARY KEY (NCODIEVENT)
  USING INDEX;
ALTER TABLE CADEVENT
  ADD CONSTRAINT UK_CADEVENT UNIQUE (NCODIEMPRE, CCODIEVENT)
  USING INDEX;
ALTER TABLE CADEVENT
  ADD CONSTRAINT FK_CADEVENT_CADEMPRE FOREIGN KEY (NCODIEMPRE)
  REFERENCES CADEMPRE (NCODIEMPRE);
  
CREATE SEQUENCE CAD_SCADEVENT NOCACHE START WITH 9;  
  
INSERT INTO CADEVENT
  (NCODIEVENT, NCODIEMPRE, CCODIEVENT, CDESCEVENT)
VALUES
  (1, 1, '773', 'ASSOCIAÇÃO/LANCHONETE');

INSERT INTO CADEVENT
  (NCODIEVENT, NCODIEMPRE, CCODIEVENT, CDESCEVENT)
VALUES
  (2, 1, '775', 'SEGURO DE VIDA');

INSERT INTO CADEVENT
  (NCODIEVENT, NCODIEMPRE, CCODIEVENT, CDESCEVENT)
VALUES
  (3, 1, '785', 'DIVERSOS');

INSERT INTO CADEVENT
  (NCODIEVENT, NCODIEMPRE, CCODIEVENT, CDESCEVENT)
VALUES
  (4, 1, '790', 'EVENTOS');

INSERT INTO CADEVENT
  (NCODIEVENT, NCODIEMPRE, CCODIEVENT, CDESCEVENT)
VALUES
  (5, 4, '773', 'ASSOCIAÇÃO/LANCHONETE');

INSERT INTO CADEVENT
  (NCODIEVENT, NCODIEMPRE, CCODIEVENT, CDESCEVENT)
VALUES
  (6, 4, '775', 'SEGURO DE VIDA');

INSERT INTO CADEVENT
  (NCODIEVENT, NCODIEMPRE, CCODIEVENT, CDESCEVENT)
VALUES
  (7, 4, '785', 'DIVERSOS');

INSERT INTO CADEVENT
  (NCODIEVENT, NCODIEMPRE, CCODIEVENT, CDESCEVENT)
VALUES
  (8, 4, '790', 'EVENTOS');
  
---------------
-- CREATE TABLE
CREATE TABLE CADTPDES
(
  NCODITPDES NUMBER NOT NULL,
  NCODIDEPAR NUMBER NOT NULL,
  CDESCTPDES VARCHAR2(255) NOT NULL,
  CVISITPDES VARCHAR2(15) DEFAULT 'NÃO' NOT NULL
);
-- ADD COMMENTS TO THE COLUMNS 
COMMENT ON COLUMN CADTPDES.NCODITPDES
  IS 'código do tipo de desconto';
COMMENT ON COLUMN CADTPDES.NCODIDEPAR
  IS 'código do departamento';
COMMENT ON COLUMN CADTPDES.CDESCTPDES
  IS 'descrição do tipo de desconto';
COMMENT ON COLUMN CADTPDES.CVISITPDES
  IS 'se tipo de desconto é visível (SIM/NÃO)';  
-- CREATE/RECREATE PRIMARY, UNIQUE AND FOREIGN KEY CONSTRAINTS 
CREATE INDEX FK_CADTPDES_SEGDEPAR ON CADTPDES (NCODIDEPAR);
ALTER TABLE CADTPDES
  ADD CONSTRAINT PK_CADTPDES PRIMARY KEY (NCODITPDES)
  USING INDEX;
ALTER TABLE CADTPDES
  ADD CONSTRAINT UK_CADTPDES UNIQUE (NCODIDEPAR, CDESCTPDES)
  USING INDEX; 
ALTER TABLE CADTPDES
  ADD CONSTRAINT FK_CADTPDES_SEGDEPAR FOREIGN KEY (NCODIDEPAR)
  REFERENCES SEGDEPAR (NCODIDEPAR);
 
CREATE SEQUENCE CAD_SCADTPDES NOCACHE START WITH 6;  
  
INSERT INTO CADTPDES
  (NCODITPDES, NCODIDEPAR, CDESCTPDES)
VALUES
  (1, 1, 'DESPESA - LANCHONETE');

INSERT INTO CADTPDES
  (NCODITPDES, NCODIDEPAR, CDESCTPDES)
VALUES
  (2, 10, 'DESPESA - LANCHONETE');

INSERT INTO CADTPDES
  (NCODITPDES, NCODIDEPAR, CDESCTPDES)
VALUES
  (3, 10, 'DESPESA - SEGURO DE VIDA');

INSERT INTO CADTPDES
  (NCODITPDES, NCODIDEPAR, CDESCTPDES)
VALUES
  (4, 10, 'DESPESA - DIVERSOS');

INSERT INTO CADTPDES
  (NCODITPDES, NCODIDEPAR, CDESCTPDES)
VALUES
  (5, 10, 'DESPESA - EVENTOS');  